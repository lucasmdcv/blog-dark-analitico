import os
from dotenv import load_dotenv
load_dotenv()

# Agora a chave não fica mais "visível" no código
TOKEN_HF = os.getenv("HF_TOKEN")

import json
import os
import requests # Para fazer chamadas HTTP para a API da IA

# --- CONFIGURAÇÃO DA API ---
# Você precisará de uma chave de API para o Gemini ou OpenAI
# Guarde sua chave em uma variável de ambiente ou um arquivo .env, NÃO no código direto!
API_KEY = os.getenv("GEMINI_API_KEY") # Exemplo: leia de uma variável de ambiente

def gerar_conteudo_com_ia(prompt_usuario):
    print(f"\n[>] IA em ação: Gerando conteúdo para '{prompt_usuario}'...")
    
    # Exemplo de como chamar uma API de IA (usando um mock para demonstração)
    # Na vida real, aqui seria uma chamada HTTP POST para a API do Gemini ou OpenAI
    
    # ESTE É UM MOCK (simulação)
    # Substitua isto pela integração REAL com a API do Gemini/OpenAI
    # Exemplo: response = requests.post("https://api.gemini.google/v1/generate", json={"prompt": prompt_usuario, "max_tokens": 500}, headers={"Authorization": f"Bearer {API_KEY}"})
    # content = response.json()["text"]
    
    # Conteúdo de exemplo gerado pelo MOCK
    titulo_gerado = f"Análise Profunda: O Futuro de {prompt_usuario} no Universo Geek"
    resumo_gerado = f"Descubra as tendências e impactos de {prompt_usuario} na cultura pop, games e séries, com insights gerados por inteligência artificial."
    conteudo_detalhado = f"A IA explorou os mais recentes lançamentos e discussões online sobre {prompt_usuario}. Observa-se que a convergência de tecnologias está redefinindo a experiência do usuário. Novas narrativas estão surgindo em jogos VR/AR, e os serviços de streaming investem cada vez mais em produções interativas. Este post, gerado por IA, visa oferecer uma perspectiva única sobre o tema."

    return titulo_gerado, resumo_gerado, conteudo_detalhado

def postador_inteligente():
    print("\n--- [LUCAS_NEWS] SISTEMA DE GERAÇÃO DE CONTEÚDO IA ---")
    
    prompt = input("Qual o tema do blog que a IA deve gerar? (Ex: 'novo filme de ficção científica', 'tendências em jogos VR'): ")
    
    titulo, resumo, conteudo_detalhado = gerar_conteudo_com_ia(prompt)

    categoria = input("Categoria (GAMES, FILMES, CYBER, F1, IA): ").upper()
    local = "Ciberespaço"
    tempo = "IA Gerado"

    novo_post = {
        "categoria": categoria,
        "titulo": titulo,
        "resumo": resumo,
        "conteudo_completo": conteudo_detalhado, # Adicionei campo para conteúdo completo
        "tempo": tempo,
        "local": local,
        "imagem_url": "" # Placeholder para a imagem que vamos gerar depois
    }

    arquivo = 'posts.json'
    if os.path.exists(arquivo):
        with open(arquivo, 'r', encoding='utf-8') as f:
            try:
                posts = json.load(f)
            except json.JSONDecodeError: # Lida com JSON vazio ou mal formatado
                posts = []
    else:
        posts = []

    posts.insert(0, novo_post)

    with open(arquivo, 'w', encoding='utf-8') as f:
        json.dump(posts, f, indent=4, ensure_ascii=False)
    
    print(f"\n[SUCESSO] Post sobre '{titulo}' gerado pela IA e salvo no JSON!")

    deploy = input("\nDeseja subir para o Netlify agora? (s/n): ")
    if deploy.lower() == 's':
        print("[>] Iniciando Deploy...")
        os.system('git add .')
        os.system(f'git commit -m "IA Post: {titulo}"')
        os.system('git push origin main')
        print("[OK] Site atualizado com sucesso!")

if __name__ == "__main__":
    postador_inteligente()